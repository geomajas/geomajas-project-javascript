<html>
	<!--
	  ~ This is part of Geomajas, a GIS framework, http://www.geomajas.org/.
	  ~
	  ~ Copyright 2008-2014 Geosparc nv, http://www.geosparc.com/, Belgium.
	  ~
	  ~ The program is available in open source according to the GNU Affero
	  ~ General Public License. All contributions in this program are covered
	  ~ by the Geomajas Contributors License Agreement. For full licensing
	  ~ details, see LICENSE.txt in the project root.
	-->
	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
		<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />

		<title>Geomajas Javascript API Showcase</title>
		<link type="text/css" rel="stylesheet" href="geomajas.css" />

		<script type="text/javascript" language="javascript">var isomorphicDir = "../emptyApp/sc/";</script>
		<script type="text/javascript" language="javascript" src="../emptyApp/emptyApp.nocache.js"></script>

		<script type="text/javascript">
			var map;
            var osmLayer;
            var osmId = 'clientLayerOsm';
            var countriesLayer;
            var countriesId = 'clientLayerCountries';
	
			function onGeomajasLoad() {
			    // do nothing
			}

			function createAndInitializeMap() {
                // clear the parent tag
                document.getElementById("js-map-element").innerHTML = "";

                // Create the map:
                map = new gm.Map("js-map-element");
                // register handlers
                map.getEventBus().addLayerAddedHandler(function(event) {
                    displayLayerAddedEvent(event);
                });
                map.getEventBus().addLayerRemovedHandler(function(event) {
                    displayLayerRemovedEvent(event);
                });
                map.getEventBus().addMapInitializationHandler(function(event) {
                    displayMapInitialization(event);
                });
                gm.ServerExtension.initializeMap(map, "app", "mapMain");
			}

			function clearLogging() {
                document.getElementById("log").innerHTML = "";
			}

            function displayLayerAddedEvent(event) {
                var log = document.getElementById("log");
                log.innerHTML += "LayerAddedEvent fired. Added layer: " + event.getAddedLayer().getTitle() +
                        ". Currently " +
                        map.getLayersModel().getLayerCount() + " layers<br>";
            }

            function displayLayerRemovedEvent(event) {
                var log = document.getElementById("log");
                log.innerHTML += "LayerRemovedEvent fired. Removed layer: " + event.getRemovedLayer().getTitle() +
                        ". Currently " + map.getLayersModel().getLayerCount() + " layers<br>";
            }

            function displayMapInitialization(event) {
                var log = document.getElementById("log");
                log.innerHTML += "Event MapInitialization fired<br>";
                osmLayer = map.getLayersModel().getLayer(osmId);
                countriesLayer = map.getLayersModel().getLayer(countriesId);
            }

            function toggleAddRemove(layer) {
                var layerId = layer.getId();
                var layerIndex = map.getLayersModel().getLayerPosition(layer);
                if (layerIndex < 0) {
                    // layer not in layersModel => add
                    map.getLayersModel().addLayer(layer);
                    if (layerId == osmId) {
                        document.getElementById("osmButtonSpan").innerHTML = 'Remove';
                    } else if (layerId == countriesId) {
                        document.getElementById("countriesButtonSpan").innerHTML = 'Remove';
                    }
                } else {
                    // layer in layersModel => remove
                    map.getLayersModel().removeLayer(layerId);
                    if (layerId == osmId) {
                        document.getElementById("osmButtonSpan").innerHTML = 'Add';
                    } else if (layerId == countriesId) {
                        document.getElementById("countriesButtonSpan").innerHTML = 'Add';
                    }
                }
            }
		</script>
	</head>

	<body>
		<div class="titleBar">
			<div class="title">Geomajas JavaScript API test</div>
			<div class="subtitle">This example uses an empty GWT application - JavaScript only</div>
		</div>
		<div>
			<table cellspacing="0" cellpadding="5">
				<tr>
					<td style="width: 640px;">
						<div id="js-map-element" style="width: 640px; height: 480px; border: 1px solid #337428;">
							<!-- on load, the map is attached here -->
						</div>
					</td>
					<td valign="top">
						<h2>Basic map and layer events</h2>

						<p>
							When the Geomajas map is initialized, the map is build in a number of steps.
                            E.g. a request is sent to the server to ask for the map's configuration.
                            The layers are added one by one to the map.<br>
                            This example shows the events that are fired and how to listen to these events.
                            First, create and initialize the map; the remove or add the layers.
						</p>
                        <button onclick="createAndInitializeMap()">Create And Initialize Map</button><br>
                        <button onclick="toggleAddRemove(osmLayer)"><span id="osmButtonSpan">Remove</span> Osm layer</button>
                        <button onclick="toggleAddRemove(countriesLayer)"><span id="countriesButtonSpan">Remove</span> countries layer</button>

						<h4>Event logging <button onclick="clearLogging()">Clear logging</button></h4>
						<div id="log"></div>
					</td>
				</tr>
			</table>
		</div>
	</body>

</html>